# AitoVideo — Принятые решения

## 2026-02-27: Отказ от ручного выбора качества в пользу автоматического

**Решение:** Удалили UI-селектор качества и поддержку параметра `quality` в API. Система теперь автоматически выбирает лучшее прогрессивное качество (до 1080p MP4) на стороне бэкенда. Жесты масштабирования (pinch-to-zoom) сохранены как основной инструмент адаптации под размер экрана.

**Контекст:**
- Ручной выбор качества усложнял UI и приводил к нестабильному результату при смене форматов.
- Сокращение кода упрощает поддержку и снижает вероятность багов в логике кэширования.
- Пользователь предпочитает "просто чтобы работало" в максимально доступном качестве.

**Последствия:**
- API /api/youtube/stream/:videoId больше не принимает параметр quality.
- Кэш на бэкенде теперь привязан только к videoId.

---

## 2026-02-26: Zoom в плеере Mini App (устаревшее решение для качества удалено) Для 1080p backend использует selector `best[height<=1080][ext=mp4][vcodec!=none][acodec!=none]/best[height<=1080]`, чтобы предпочитать единый URL потока без принудительного fallback на 720p. В UI оставлен gesture zoom (`pinch-to-zoom`) и double-tap reset без отдельных `+/-` кнопок.

**Контекст:**
- Нужен быстрый контроль качества без отдельного экрана настроек.
- В Telegram Mini App часто есть letterboxing, поэтому zoom > 100% улучшает UX.
- Пользователь ожидает, что выбранное качество сохраняется между сессиями.

**Альтернативы:**
- Отдельная страница настроек качества (хуже UX в fullscreen-плеере).
- Muxed selector через `137+140` для 1080p (может вернуть несколько URL и приводить к понижению качества).

**Последствия:**
- Backend `GET /api/youtube/stream/:videoId` должен учитывать `quality` в format selector и кэше stream URL.
- Frontend `Player` хранит пользовательское качество в `localStorage`, показывает активное качество в панели и применяет `transform: scale()` к media-контейнеру через touch-жесты.

---

## 2025-02-26: Переход на AI-native workflow

**Решение:** Настраиваем автономную работу агентов под управлением Kimi Claw.

**Контекст:**
- Пилотный проект для нового подхода
- Полная автономия агентов с возможностью ручного вмешательства
- Ты сам можешь кодировать с агентом в Cursor IDE

**Структура управления:**
1. Kimi Claw — оркестрация, контекст, контроль
2. Cursor Cloud Agent — выполнение задач в репо
3. Иван — финальное ревью критичных изменений, совместное кодирование

**Инфраструктура:**
- `.openclaw/` — контекст для агентов
- GitHub Projects — трекинг (автоматическое обновление)
- GitHub Actions — CI/CD, автоматические проверки

---

## 2025-02-21: Стек и архитектура

**Решение:** Node.js + SQLite + React Mini App

**Почему:**
- Простота деплоя (один бинарник)
- SQLite достаточно для MVP
- React — стандарт для Mini Apps

---

*[Шаблон для новых решений]*

## YYYY-MM-DD: Краткое описание

**Решение:** Что решили

**Контекст:** Почему решили именно так

**Альтернативы:** Что рассматривали

**Последствия:** Что теперь нельзя менять без пересмотра
